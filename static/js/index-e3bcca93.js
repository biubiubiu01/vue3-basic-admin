import{_ as O}from"./base-dialog.vue_vue_type_style_index_0_lang-c14e94f3.js";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang-127883b2.js";import{_ as z}from"./base-select.vue_vue_type_script_lang-d001047d.js";import{d as L,b as q,r as b,v as H,a0 as J,o as n,A as w,w as i,e as y,D as B,g as s,i as c,f as h,c as p,a4 as P,ab as m,t as K,c2 as Q}from"./index-bd68377b.js";import{_ as W}from"./index-d97fff49.js";import"./el-popper-ec19954e.js";import"./el-space-cf3eea44.js";/* empty css                  *//* empty css                 */import"./el-tag-680f8e7f.js";import"./el-tree-fb98b636.js";import"./index-414ef697.js";import"./el-checkbox-1de7bb5d.js";import"./_Uint8Array-4312697e.js";import"./debounce-ba2e3c7a.js";import"./index-9fb5db53.js";import"./el-col-435232e7.js";const X={class:"base-photograph-container"},Y={class:"base-photograph-controls mt20"},Z=["src"],ee=["src"],oe=L({__name:"base-photograph",props:{title:{type:String,default:"\u62CD\u7167"},width:{type:Number,default:640},height:{type:Number,default:320},photo:{type:Boolean,default:!1},video:{type:Boolean,default:!1}},emits:["getImg","getVideo"],setup(f,{expose:U,emit:g}){const a=f,{error:D}=Q(),e=q({videoDevices:[{label:"\u9ED8\u8BA4\u5F55\u50CF\u8BBE\u5907",value:"default"}],constraints:{video:{deviceId:"default",autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,width:a.width,height:a.height,aspectRatio:a.width/a.height}},selectedDevice:"default",stream:null,photoLoading:!1,photoUrl:null,mediaRecorder:null,chunkList:[],isPause:!1,videoUrl:null}),C=b(),l=b(),r=H(()=>{const{width:o,height:t}=a;return{width:`${o}px`,height:`${t}px`}});J(()=>{F()});const v=()=>{e.stream=null,e.photoUrl=null,e.chunkList=[],e.videoUrl=null,s(C).showDialog(),R()},_=()=>{s(C).hideDialog()},R=()=>{var o;if(typeof MediaRecorder>"u"&&!((o=navigator==null?void 0:navigator.mediaDevices)!=null&&o.getUserMedia))return console.error("MediaRecorder not supported on your browser, use Firefox 30 or Chrome 49 instead.");navigator.mediaDevices.getUserMedia(e.constraints).then(t=>{s(l)&&(s(l).controls=!1),e.stream=t;try{s(l).srcObject=t,s(l).onloadedmetadata=()=>{s(l).play()}}catch{D("\u521D\u59CB\u5316\u62CD\u7167\u8BBE\u5907\u5931\u8D25\uFF01")}}).catch(t=>console.log(`navigator.getUserMedia error: ${t}`))},k=o=>{e.constraints.video.deviceId=o,e.selectedDevice=o,V(),R()},F=()=>{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices().then(o=>{o.forEach((t,d)=>{t.kind==="videoinput"&&e.videoDevices.push({label:t.label||`\u5F55\u50CF\u8BBE\u5907-${d+1}`,value:t.deviceId})})})},V=()=>{var o,t;(t=(o=e.stream)==null?void 0:o.getTracks())==null||t.forEach(d=>{var u;(u=d==null?void 0:d.stop)==null||u.call(d)}),e.stream=null},E=()=>{if(e.photoUrl)return;e.photoLoading=!0;const o=document.createElement("canvas");o.width=a.width,o.height=a.height,o.getContext("2d").drawImage(s(l),0,0,a.width,a.height),e.photoUrl=o.toDataURL("image/png"),e.photoLoading=!1},x=()=>{e.photoUrl=null},M=()=>{g("getImg",e.photoUrl),_()},S=()=>{e.chunkList.length||A()},I=()=>{e.isPause=!e.isPause,e.isPause?e.mediaRecorder.pause():e.mediaRecorder.resume()},N=()=>{e.videoUrl||(e.mediaRecorder.stop(),s(l).controls=!0,e.isPause=!1)},G=()=>{g("getVideo",e.videoUrl),_()},A=()=>{e.mediaRecorder=new MediaRecorder(e.stream,{mimeType:"video/webm"}),e.mediaRecorder.start(10),e.mediaRecorder.ondataavailable=o=>{e.chunkList.push(o.data)},e.mediaRecorder.onerror=o=>{},e.mediaRecorder.onstart=()=>{""+e.mediaRecorder.state},e.mediaRecorder.onstop=()=>{""+e.mediaRecorder.state;const o=new Blob(e.chunkList,{type:"video/webm"});e.chunks=[];const t=window.URL.createObjectURL(o);e.videoUrl=t,s(l).src=t},e.mediaRecorder.onpause=()=>{""+e.mediaRecorder.state},e.mediaRecorder.onresume=()=>{""+e.mediaRecorder.state},e.mediaRecorder.onwarning=o=>{}};return U({showDialog:v,hideDialog:_}),(o,t)=>{const d=z,u=$,T=O;return n(),w(T,{ref_key:"baseDialogRef",ref:C,title:f.title,"show-footer":!1,showFullscreen:!1,width:f.width+40,onClose:V},{default:i(()=>[y("div",X,[y("video",{ref_key:"videoRef",ref:l,autoplay:"",style:B(s(r))},null,4),y("div",Y,[c(" \u6444\u50CF\u5934\uFF1A "),h(d,{modelValue:e.selectedDevice,"onUpdate:modelValue":t[0]||(t[0]=j=>e.selectedDevice=j),clearable:!1,options:e.videoDevices,onChange:k},null,8,["modelValue","options"]),f.photo?(n(),p(P,{key:0},[h(u,{class:"ml10",onClick:E,loading:e.photoLoading},{default:i(()=>[c("\u62CD\u7167")]),_:1},8,["loading"]),e.photoUrl?(n(),w(u,{key:0,class:"ml10",onClick:x},{default:i(()=>[c("\u91CD\u65B0\u62CD\u7167")]),_:1})):m("",!0),e.photoUrl?(n(),w(u,{key:1,class:"ml10",onClick:M},{default:i(()=>[c("\u4F7F\u7528\u7167\u7247")]),_:1})):m("",!0),e.photoUrl?(n(),p("img",{key:2,src:e.photoUrl,class:"absolute",style:B({...s(r),top:0,left:0})},null,12,Z)):m("",!0)],64)):m("",!0),f.video?(n(),p(P,{key:1},[h(u,{class:"ml10",onClick:S},{default:i(()=>[c("\u5F00\u59CB\u5F55\u5236")]),_:1}),h(u,{class:"ml10",onClick:I},{default:i(()=>[c(K(e.isPause?"\u7EE7\u7EED":"\u6682\u505C"),1)]),_:1}),h(u,{class:"ml10",onClick:N},{default:i(()=>[c("\u505C\u6B62")]),_:1}),e.videoUrl?(n(),w(u,{key:0,class:"ml10",onClick:G},{default:i(()=>[c("\u4F7F\u7528\u89C6\u9891")]),_:1})):m("",!0),e.videoUrl?(n(),p("video",{key:1,autoplay:"",style:B({...s(r),top:0,left:0}),src:e.videoUrl,controls:"",class:"absolute"},null,12,ee)):m("",!0)],64)):m("",!0)])])]),_:1},8,["title","width"])}}}),te={class:"com-photograph-container"},se={class:"mt15"},ae=["src"],ie={class:"mt15"},le=["src"],Ue=L({__name:"index",setup(f){const U=b(),g=b(null),a=b(),D=b(!1),e=(r=!1)=>{D.value=r,s(U).showDialog()},C=r=>{g.value=r},l=r=>{a.value=r};return(r,v)=>{const _=$,R=W,k=oe;return n(),p("div",te,[h(R,{title:"\u62CD\u7167"},{default:i(()=>[h(_,{onClick:v[0]||(v[0]=F=>e(!0))},{default:i(()=>[c("\u70B9\u51FB\u62CD\u7167")]),_:1}),y("div",se,[g.value?(n(),p("img",{key:0,src:g.value,alt:""},null,8,ae)):m("",!0)])]),_:1}),h(R,{title:"\u5F55\u5236"},{default:i(()=>[h(_,{onClick:v[1]||(v[1]=F=>e(!1))},{default:i(()=>[c("\u5F55\u5236")]),_:1}),y("div",ie,[a.value?(n(),p("video",{key:0,autoplay:"",width:"640",height:"320",src:a.value,controls:""},null,8,le)):m("",!0)])]),_:1}),h(k,{ref_key:"basePhotographRef",ref:U,onGetImg:C,onGetVideo:l,photo:D.value,video:!D.value},null,8,["photo","video"])])}}});export{Ue as default};
