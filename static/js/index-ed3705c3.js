import{d as C,b as N,r as S,v as i,c0 as R,c7 as k,g as n,U,o as v,c as b,e as y,D as O,a4 as F,b8 as L,B as j,C as V,a5 as M,l as $,a2 as W,b4 as Y,cF as P,f as d,w as _,t as B}from"./index-bd68377b.js";import{E as q,a as G}from"./el-col-435232e7.js";import{_ as K}from"./index-d97fff49.js";import"./el-popper-ec19954e.js";const z={className:{type:String,default:""},style:{type:[Object,String,Array]},height:{type:Number,default:500},width:{type:[Number,String],default:"100%"},itemHeight:{type:Number,default:30},dynamic:{type:Boolean,default:!1},cache:{type:Number,default:2},data:{type:Array,default:()=>[]}},Q=["id"],X=C({__name:"base-virtual-observer",props:z,setup(I){const s=I,t=N({start:0,end:20,scrollOffset:0,cacheData:[]}),o=S(),E=i(()=>{const{style:e,height:a,width:r}=s,c=R(e)?JSON.parse(e):{...e};return{height:`${a}px`,width:k(r)?`${r}px`:r,...c}}),D=i(()=>({height:`${n(x)}px`,width:"100%"})),f=i(()=>({willChange:"transform",transform:`translateY(${t.scrollOffset}px)`})),l=i(()=>s.data.length),x=i(()=>n(l)*s.itemHeight),m=i(()=>Math.ceil(s.height/s.itemHeight)),h=i(()=>s.data.slice(t.start,t.end)),H=()=>{M(()=>{var e,a;(e=n(o))==null||e.unobserve(document.getElementById("_top")),(a=n(o))==null||a.unobserve(document.getElementById("_bottom"))})},A=e=>{e.forEach(a=>{a.isIntersecting&&a.target.id==="_bottom"&&(t.end=Math.min(t.end+n(m),n(l)),t.start=Math.max(t.end-n(m)*2,0),t.scrollOffset=t.start*s.itemHeight),a.isIntersecting&&a.target.id==="_top"&&(t.end=t.end===20?20:t.end-10>20?t.end-10:20,t.start=t.start===0?0:t.start-10>0?t.start-10:0),t.scrollOffset=t.start*s.itemHeight})},p=()=>{n(l)<n(m)||(o.value=new IntersectionObserver(A,{threshold:.1}),M(()=>{n(o).observe(document.getElementById("_top")),n(o).observe(document.getElementById("_bottom"))}))};return U(()=>t.end,()=>{H(),p()},{immediate:!0}),(e,a)=>(v(),b("div",{class:V(["base-virtual-wrapper",e.className]),ref:"wrapperRef",style:O(n(E))},[y("div",{class:"base-virtual-inner",ref:"innerRef",style:O(n(D))},[y("div",{class:"base-virtual-list",style:O(n(f))},[(v(!0),b(F,null,L(n(h),(r,c)=>(v(),b("div",{key:c+t.start,id:c===n(h).length-1?"_bottom":c===0?"_top":""},[j(e.$slots,"default",{item:r},void 0,!0)],8,Q))),128))],4)],4)],6))}});const Z=$(X,[["__scopeId","data-v-94651c1d"]]),tt=C({__name:"base-virtual-list",props:z,setup(I){const s=I,t=N({start:0,end:10,scrollOffset:0,cacheData:[]}),o=S(),E=i(()=>{const{style:e,height:a,width:r}=s,c=R(e)?JSON.parse(e):{...e};return{height:`${a}px`,width:k(r)?`${r}px`:r,...c}}),D=i(()=>({height:`${n(x)}px`,width:"100%"})),f=i(()=>({willChange:"transform",transform:`translateY(${t.scrollOffset}px)`})),l=i(()=>s.data.length),x=i(()=>s.dynamic?p(n(l)):n(l)*s.itemHeight),m=i(()=>Math.ceil(s.height/s.itemHeight)),h=i(()=>s.data.slice(t.start,t.end)),H=e=>{const{scrollTop:a}=e.target;if(t.scrollOffset===a)return;const{cache:r,dynamic:c,itemHeight:u}=s,g=Math.max(1,r);let w=c?A(a):Math.floor(a/u);const J=Math.max(0,Math.min(n(l),w+n(m)+g));w>g&&(w=w-g);const T=c?p(w):a-a%u;Object.assign(t,{start:w,end:J,scrollOffset:T})},A=(e=0)=>{let a=0,r=t.cacheData.length-1;for(;a<=r;){const c=a+Math.floor((r-a)/2),u=p(c),g=p(c+1);if(u<=e&&e<=g)return c;g<e?a=c+1:g>e&&(r=c-1)}return Math.min(n(l)-n(m),Math.floor(e/s.itemHeight))},p=e=>{const a=t.cacheData.length-1;return Object.hasOwn(t.cacheData,e)?t.cacheData[e].top:Object.hasOwn(t.cacheData,e-1)?t.cacheData[e-1].bottom:e>a?t.cacheData[a].bottom+Math.max(0,e-t.cacheData[a].index)*s.itemHeight:e*s.itemHeight};return W(()=>{if(!s.dynamic)return;[...o.value.children||[]].forEach((a,r)=>{const c=a.getBoundingClientRect().height,u=t.start+r;t.cacheData[u].height!==c&&(t.cacheData[u].height=c,t.cacheData[u].top=p(u),t.cacheData[u].bottom=t.cacheData[u].top+t.cacheData[u].height)})}),Y(()=>{h.value.forEach((e,a)=>{const r=t.start+a;Object.hasOwn(t.cacheData,r)||(t.cacheData[r]={top:r*s.itemHeight,height:s.itemHeight,bottom:(r+1)*s.itemHeight,index:r})})}),(e,a)=>(v(),b("div",{class:V(["base-virtual-wrapper",e.className]),ref:"wrapperRef",style:O(n(E)),onScroll:H},[y("div",{class:"base-virtual-inner",ref:"innerRef",style:O(n(D))},[y("div",{class:"base-virtual-list",style:O(n(f)),ref_key:"virtualListRef",ref:o},[(v(!0),b(F,null,L(n(h),(r,c)=>(v(),b("div",{key:c+t.start},[j(e.$slots,"default",{item:r},void 0,!0)]))),128))],4)],4)],38))}});const et=$(tt,[["__scopeId","data-v-e63f8b9f"]]),at={class:"com-virtualscroll-container"},st={class:"item",style:{"text-align":"center",height:"50px"}},nt={class:"item"},rt={class:"item",style:{"text-align":"center",height:"50px"}},ct=C({__name:"index",setup(I){const s=S([]),t=S([]);for(let o=0;o<1e5;o++)s.value.push(o),t.value.push(o+1+". "+P.exports.Random.cparagraph(1,40));return(o,E)=>{const D=et,f=K,l=q,x=G,m=Z;return v(),b("div",at,[d(x,null,{default:_(()=>[d(l,{span:12},{default:_(()=>[d(f,{title:"\u56FA\u5B9A\u9AD8\u5EA6(\u4F20\u7EDF\u6EDA\u52A8)"},{default:_(()=>[d(D,{data:s.value,"item-height":50},{default:_(({item:h})=>[y("div",st,B(h),1)]),_:1},8,["data"])]),_:1})]),_:1}),d(l,{span:12},{default:_(()=>[d(f,{title:"\u52A8\u6001\u9AD8\u5EA6(\u4F20\u7EDF\u65B9\u6CD5)"},{default:_(()=>[d(D,{data:t.value,"item-height":50,dynamic:""},{default:_(({item:h})=>[y("div",nt,B(h),1)]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),d(x,{class:"mt20"},{default:_(()=>[d(l,{span:12},{default:_(()=>[d(f,{title:"\u56FA\u5B9A\u9AD8\u5EA6(IntersectionObserver)"},{default:_(()=>[d(m,{data:s.value,"item-height":50},{default:_(({item:h})=>[y("div",rt,B(h),1)]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})])}}});const ht=$(ct,[["__scopeId","data-v-a2e57248"]]);export{ht as default};
